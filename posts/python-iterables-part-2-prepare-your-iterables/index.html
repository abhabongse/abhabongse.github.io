<!DOCTYPE html>
<html lang="en">
<head>
        <title>Prepare Your Iterables – Python Iterables Part 2 of N @ Personal Blog</title>

    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="HandheldFriendly" content="True"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

    <link href="https://fonts.googleapis.com/css2?family=Fira+Code&family=Kanit:ital,wght@0,300;0,600;1,300;1,600&family=Roboto:ital,wght@0,400;0,700;1,400;1,700&family=Sarabun:ital,wght@0,300;0,600;1,300;1,600&display=swap" rel="stylesheet">
    <link rel="stylesheet" 
          href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" 
          integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" 
          crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js" 
            integrity="sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4" 
            crossorigin="anonymous"></script>
    <link rel="stylesheet" 
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" 
          integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" 
          crossorigin="anonymous">

    <link rel="stylesheet" type="text/css" href="/theme/css/main.css"/>

<link href="https://abhabongse.github.io/feeds/all.atom.xml"
          type="application/atom+xml" rel="alternate" title="Personal Blog Full Atom Feed"/><link href="https://abhabongse.github.io/feeds/category-coding.atom.xml"
          type="application/atom+xml" rel="alternate" title="Personal Blog Categories Atom Feed"/>



        <meta name="tags" content="python" />
        <meta name="tags" content="iterators" />
</head>
<body id="index" class="post-template">
<div class="site-wrapper">

<header class="site-header">
<div class="outer site-nav-main">
    <div class="inner">
<nav class="site-nav">
    <div class="site-nav-left-wrapper">
        <div class="site-nav-left">
            <a class="site-nav-logo" href="/"><img src="/images/logo.png" alt="Personal Blog" /></a>
            <div class="site-nav-content">
                <ul class="nav">
                        <li><a href="/pages/about">About</a></li>
                        <li class="active"><a href="/category/coding">coding</a></li>
                        <li><a href="/category/music">music</a></li>
                        <li><a href="/category/others">others</a></li>
                </ul>
                    <span class="nav-post-title ">Prepare Your Iterables – Python Iterables Part 2 of N</span>
            </div>
        </div>
    </div>
    <div class="site-nav-right">
        <div class="social-links">
            <a class="social-link social-link-fb" href="https://facebook.com/abhabongse" title="Facebook" target="_blank" rel="noopener">
<svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><path d="M16 0c8.837 0 16 7.163 16 16s-7.163 16-16 16S0 24.837 0 16 7.163 0 16 0zm5.204 4.911h-3.546c-2.103 0-4.443.885-4.443 3.934.01 1.062 0 2.08 0 3.225h-2.433v3.872h2.509v11.147h4.61v-11.22h3.042l.275-3.81h-3.397s.007-1.695 0-2.187c0-1.205 1.253-1.136 1.329-1.136h2.054V4.911z" /></svg>            </a>
            <a class="social-link social-link-tw" href="https://twitter.com/abhabongse" title="Twitter" target="_blank" rel="noopener">
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>            </a>
            <a class="social-link social-link-fb" href="https://github.com/abhabongse" title="GitHub" target="_blank" rel="noopener">
<svg xmlns="http://www.w3.org/2000/svg" height="32" width="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path></svg>            </a>
        </div>
        <a class="rss-button" href="https://abhabongse.github.io/feeds/all.atom.xml" title="RSS" target="_blank" rel="noopener">
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="6.18" cy="17.82" r="2.18"/><path d="M4 4.44v2.83c7.03 0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9 0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"/></svg>        </a>
    </div>
</nav>    </div>
</div></header>

<main id="site-main" class="site-main outer">
    <div class="inner">
        <article class="post-full post ">

            <header class="post-full-header">

                <section class="post-full-tags">
                    <a href="/category/coding">coding</a>
                        <span class="bull">&nbsp;&bull;&nbsp;</span>
                        <a href="/tag/python">python</a>
                        <span class="bull">&nbsp;&bull;&nbsp;</span>
                        <a href="/tag/iterators">iterators</a>
                </section>

                <h1 class="post-full-title">Prepare Your Iterables – Python Iterables Part 2 of N</h1>


                <div class="post-full-byline">
                    <section class="post-full-byline-content">
                        <ul class="author-list">
                            <li class="author-list-item">
                                <div class="author-card">

                                    <img class="author-profile-image" src="/avatars/d59f180139c7ef4544b6f34b97ed942cf4f486a3e833683a9ca1e1b298e18ca8.jpg" alt="Abhabongse Janthong" />
                                    <div class="author-info">
                                            <div class="bio">
                                                <h2>Abhabongse Janthong</h2>
                                                <p>A programmer who tries to protect himself from his future self</p>
                                                <p><a href="/author/abhabongse-janthong">More posts</a> by Abhabongse Janthong.</p>
                                            </div>
                                    </div>
                                </div>

                                <a href="/author/abhabongse-janthong" class="author-avatar">
                                    <img class="author-profile-image" src="/avatars/d59f180139c7ef4544b6f34b97ed942cf4f486a3e833683a9ca1e1b298e18ca8.jpg" alt="Abhabongse Janthong" />
                                </a>

                            </li>
                        </ul>

                        <section class="post-full-byline-meta">
                            <h4 class="author-name">Abhabongse Janthong</h4>
                            <div class="byline-meta-content">
                                Published: <time class="byline-meta-date published" datetime="2019-07-17T00:00:00+07:00">
                                Wed 17 July 2019
                            </time>
                                <span class="bull">&bull;</span>
                                25 min read
                            </div>
                        </section>

                    </section>
                </div>
            </header>

            <figure class="post-full-image">
                <img sizes="(max-width: 800px) 400px,
                            (max-width: 1170px) 1170px,
                            2000px"
                    src="/images/featured/gajoen-knitted-cube.jpg"
                    alt="Prepare Your Iterables – Python Iterables Part 2 of N"
                />
            </figure>

            <section class="post-full-content">
                <div class="post-content">
                    <p><a href="/posts/python-iterables-part-1">บทความที่แล้ว</a>ได้กล่าวถึง for statement ของภาษา Python
ซึ่งจะต้องใช้งานควบคู่กับวัตถุประเภท iterable เท่านั้น</p><p>บทความนี้จะพูดถึงเทคนิคการจัดการกับลำดับของข้อมูล (sequence of data) ที่จะช่วยให้ for statement 
อ่านเข้าใจง่าย ดูสละสลวยขึ้น และยังมีประสิทธิภาพในการทำงานที่ดีอีกด้วย</p><p>เราจะสนใจโจทย์ปัญหาต่อไปนี้เพื่อทำให้เรื่องราวที่จะนำเสนอเป็นรูปธรรมยิ่งขึ้น</p><h2><a class="headeranchor" id="payhaa-k-kaarkhamnwnhaa-local-maxima-ainkhmuultaaraangsngmiti"></a>ปัญหา ก. การคำนวณหา local maxima ในข้อมูลตารางสองมิติ<a class="headerlink" href="#payhaa-k-kaarkhamnwnhaa-local-maxima-ainkhmuultaaraangsngmiti" title="Permalink to this headline"></a></h2><blockquote><p>สมมติว่ามีข้อมูลเป็นตารางสองมิติ โดยที่แต่ละช่องมีค่าเป็นจำนวนจริง</p><p>&hairsp;<strong>นิยาม:</strong>&hairsp; ข้อมูลในช่องหนึ่ง&hairsp;ๆ จะจัดว่าเป็น &hairsp;<strong>local maximum</strong>&hairsp;
    ถ้าช่องดังกล่าวมีค่า&hairsp;<strong>มากกว่า</strong>&hairsp;ข้อมูลในช่องที่อยู่ติดกันในแนวตั้ง ในแนวนอน หรือในแนวทแยงมุม
    (เรียกรวม&hairsp;ๆ ว่าเป็น “ช่องเพื่อนบ้าน”)</p><p>จงหาพิกัดของค่า local maxima ทุกช่องที่ปรากฏในข้อมูลตารางที่กำหนดให้ &nbsp;
    ให้ตอบพิกัดซึ่งเป็นค่าดัชนีแนวตั้ง (row index) และแนวนอน (column index) ของแต่ละช่อง</p><p>&hairsp;<strong>หมายเหตุ:</strong>&hairsp; maxima เป็นคำพหูพจน์ของคำว่า maximum</p></blockquote><p>เพื่อความสะดวกและรวดเร็ว จะขอกำหนดให้ข้อมูลตารางอยู่ในรูปของ
<code>numpy.ndarray</code><label for="sidenote-7feb1e4d7160" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sidenote-7feb1e4d7160" class="margin-toggle"/><span class="sidenote"><a href="https://www.numpy.org/devdocs/reference/arrays.ndarray.html">See reference</a></span>
สองมิติ &nbsp;
แต่วิธีการแก้ปัญหาที่จะนำเสนอต่อจากนี้ไป จะไม่จำเพาะเจาะจงกับไลบรารี่ <code>numpy</code> เพียงอย่างเดียว
ผู้อ่านไม่จำเป็นต้องมีประสบการณ์ในการใช้งานไลบรารี่ดังกล่าวมาก่อนแต่อย่างใด</p><p>เราจะยกตัวอย่างข้อมูลตารางสองมิติ ในตัวแปรชื่อ <code>grid</code> ซึ่งมีค่าดังต่อไปนี้</p><div class="highlight"><div class="highlight-wrapper"><table class="highlight-table"><tbody><tr class="highlight-line-noop"><td><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><br></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="n">grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span>  <span class="mi">0</span><span class="p">],</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>                 <span class="p">[</span> <span class="mi">8</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span>  <span class="mi">9</span><span class="p">,</span>  <span class="mi">1</span><span class="p">],</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>                 <span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span>  <span class="mi">2</span><span class="p">],</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>                 <span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span>  <span class="mi">6</span><span class="p">]])</span></pre></td></tr></tbody></table></div></div><p>ข้อมูลตาราง <code>grid</code> ในตัวอย่างข้างต้น จะมี local maxima อยู่ 3 ช่องซึ่งปรากฏอยู่ที่ตำแหน่ง
<code>(1, 0)</code>, <code>(1, 2)</code> และ <code>(3, 3)</code> ตามลำดับ</p><ul><li>ช่องตาราง <code>grid[1, 0]</code> มีค่าเท่ากับ <code>8</code> จัดว่าเป็น local maximum
        เพราะมีมูลค่ามากกว่าช่องเพื่อนบ้านทั้งหมดที่อยู่ติดกัน
        (อันได้แก่ <code>-4</code>, <code>5</code>, <code>6</code>, <code>-3</code> และ <code>-2</code>
        เมื่อพิจารณาช่องเพื่อนบ้านแต่ละช่องเริ่มจากช่องบน วนตามเข็มนาฬิกา)</li><li>ช่องตาราง <code>grid[1, 2]</code> มีค่าเท่ากับ <code>9</code> จัดว่าเป็น local maximum อีกช่องหนึ่ง
        เพราะมีมูลค่ามากกว่าช่องเพื่อนบ้านทั้งแปดช่องที่อยู่ติดกัน
        (อันได้แก่ <code>-2</code>, <code>0</code>, <code>1</code>, <code>2</code>, <code>5</code>, <code>-3</code>, <code>6</code> และ <code>5</code>
        เมื่อพิจารณาช่องเพื่อนบ้านเริ่มจากช่องบน วนตามเข็มนาฬิกา)</li><li>ช่องตาราง <code>grid[3, 3]</code> มีค่าเท่ากับ <code>6</code> จัดว่าเป็น local maximum
        เพราะมีมูลค่ามากกว่าช่องที่อยู่ด้านบนทางซ้าย (ซึ่งมีมูลค่า <code>2</code>),
        ช่องซ้าย (มูลค่า <code>4</code>) และช่องบนซ้าย (มูลค่า <code>5</code>)</li></ul><p>ส่วนช่องอื่น&hairsp;ๆ ไม่จัดว่าเป็น local maximum เพราะอาจจะมีช่องเพื่อนบ้านบางช่องที่มีมูลค่ามากกว่าหรือเท่ากับช่องข้อมูลนั้น&hairsp;ๆ</p><p>&hairsp;<strong>เป้าหมาย:</strong>&hairsp; ต่อจากนี้ไปจะขอนำเสนอฟังก์ชันในภาษา Python ที่จะช่วยแก้ปัญหา ก. ข้างต้น
โดยเราจะเริ่มพิจารณาจากโค้ดที่ตรงไปตรงมาที่สุด (แต่อาจจะมีจุดบกพร่องบ้าง)
แล้วเราจะพยายามปรับปรุงโค้ดดังกล่าวทีละนิด จนสุดท้ายกลายเป็นโค้ดที่อ่านง่าย ดูสละสลวย และมีประสิทธิภาพที่ดี</p><h3><a class="headeranchor" id="version-1-naive-approach"></a>Version 1 – Naïve approach<a class="headerlink" href="#version-1-naive-approach" title="Permalink to this headline"></a></h3><p>โค้ดต่อไปนี้นำเสนอการคำนวณ local maxima จากข้อมูลตารางโดยใช้วิธีที่ถึกอย่างตรงไปตรงมาที่สุด &nbsp;
(มีคำอธิบายประกอบอยู่ด้านล่างโค้ด)</p><div class="highlight"><div class="highlight-wrapper"><table class="highlight-table"><tbody><tr class="highlight-line-noop"><td><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><br></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="c1"># Version 1</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="k">def</span> <span class="nf">local_maxima</span><span class="p">(</span><span class="n">table</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>    <span class="sd">&quot;&quot;&quot;</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="sd">    Compute a list of table indices where each value is a local maximum</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="sd">    in the given table data when comparing to adjacent table cells</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="sd">    (either horizontally, vertically, or diagonally).</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="sd">    &quot;&quot;&quot;</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>    <span class="c1"># data.shape describes the number of rows and columns of the table</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>    <span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">shape</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>    <span class="n">local_maxima_indices</span> <span class="o">=</span> <span class="p">[]</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><br></pre></td></tr><tr class="highlight-line-noop"><td><pre>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_rows</span><span class="p">):</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_cols</span><span class="p">):</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>            <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">table</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">table</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]:</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>                <span class="k">continue</span>  <span class="c1"># invalidated by above-left cell</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>            <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">table</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">table</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]:</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>                <span class="k">continue</span>  <span class="c1"># invalidated by above cell</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>            <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">n_cols</span><span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">table</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">table</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]:</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>                <span class="k">continue</span>  <span class="c1"># invalidated by above right cell</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>            <span class="k">if</span> <span class="n">j</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">table</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">table</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]:</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>                <span class="k">continue</span>  <span class="c1"># invalidated by left cell</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>            <span class="k">if</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">n_cols</span><span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">table</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">table</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]:</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>                <span class="k">continue</span>  <span class="c1"># invalidated by right cell</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n_rows</span><span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">table</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">table</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]:</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>                <span class="k">continue</span>  <span class="c1"># invalidated by below left cell</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n_rows</span><span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">table</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">table</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]:</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>                <span class="k">continue</span>  <span class="c1"># invalidated by below cell</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n_rows</span><span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">n_cols</span><span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">table</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">table</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]:</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>                <span class="k">continue</span>  <span class="c1"># invalidated by below right cell</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>            </pre></td></tr><tr class="highlight-line-noop"><td><pre>            <span class="c1"># Append the cell if survived checks until this point</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>            <span class="n">local_maxima_indices</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">))</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><br></pre></td></tr><tr class="highlight-line-noop"><td><pre>    <span class="k">return</span> <span class="n">local_maxima_indices</span></pre></td></tr></tbody></table></div></div><p>ตัวอย่างการเรียกใช้งานฟังก์ชัน <code>local_maxima</code> (Version 1) ข้างต้น</p><div class="highlight"><div class="highlight-wrapper"><table class="highlight-table"><tbody><tr class="highlight-line-noop"><td><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">local_maxima</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="go">[(1, 0), (1, 2), (3, 3)]</span></pre></td></tr></tbody></table></div></div><p>โอ้แม่เจ้า ถึกเสียนี่กะไร! สังเกตว่าเรามี if statement ทั้งสิ้น 8 ชุดเพื่อตรวจสอบว่าค่าของแต่ละช่อง <code>(i, j)</code>
นั้นมีค่ามากกว่าหรือเท่ากับช่องเพื่อนบ้านที่อยู่ติดกันทั้ง 8 ช่องหรือไม่ &nbsp;
(โดยเริ่มต้นเช็คกับช่องเพื่อนบ้านทางมุมบนซ้าย จนไปสิ้นสุดที่ช่องที่มุมล่างขวา) &nbsp;
หากผิดไปจากนี้แปลว่าค่าของช่อง <code>(i, j)</code> จะไม่มีทางเป็น local maxima อย่างแน่นอน</p><p>ความเลวร้ายยังไม่หยุดแค่นั้น! ในกรณีที่ช่อง <code>(i, j)</code> อยู่บนขอบตาราง
จะต้องระมัดระวังไม่นำค่าของช่องดังกล่าวไปเปรียบเทียบกับค่าของช่องที่หลุดขอบตารางออกไป &nbsp;
เช่น ถ้า <code>j == 0</code> แล้วจะ&hairsp;&hairsp;<em>ไม่</em>&hairsp;&hairsp;สามารถเปรียบเทียบค่าของช่อง
<code>(i, j)</code> กับช่อง <code>(i, j-1)</code> ที่อยู่ทางซ้ายมือได้ &nbsp;
(จึงเป็นที่มาของการตรวจเช็คเงื่อนไขในรูปของ <code>i &gt; 0</code>, <code>i &lt; r-1</code>,
<code>j &gt; 0</code> และ <code>j &lt; c-1</code> ในโค้ดข้างต้น)</p><p>แม้ว่าโค้ดข้างต้นนี้จะมีลอจิกที่เข้าใจง่าย แต่ก็ไม่ได้หมายความว่าจะเป็นโค้ดที่อ่านให้เข้าใจได้อย่างรวดเร็วทันทีนัก
และยังมีโอกาสเสี่ยงต่อการพิมพ์ผิดเล็ก&hairsp;ๆ น้อย&hairsp;ๆ อีกด้วย (เอ๊ะ? มีหรือเปล่านะ?) &nbsp;
นอกจากนี้แล้วถ้าวันหนึ่งเราจะต้องเขียนฟังก์ชัน <code>local_minima</code> ซึ่งทำงานคล้ายกับ <code>local_maxima</code>
แต่ต้องคำนวณหาตำแหน่งของ local &hairsp;<em>minima</em>&hairsp; ทั้งหมดในตารางแทนหละ &nbsp;
เราจะก็อปโค้ดนี้แล้วมาแก้เครื่องหมาย <code>&gt;=</code> ให้เป็น <code>&lt;=</code> ทีละบรรทัด ก็ไม่ใช่วิธีที่สวยงามเท่าไหร่นัก</p><h3><a class="headeranchor" id="version-2-local-3hairspxhairsp3-grid-approach"></a>Version 2 – Local 3&hairsp;×&hairsp;3 grid approach<a class="headerlink" href="#version-2-local-3hairspxhairsp3-grid-approach" title="Permalink to this headline"></a></h3><p>จุดสังเกตแรกที่จะช่วยทำให้โค้ดกระชับขึ้นก็คือ เงื่อนไขการเปรียบเทียบ <code>data[i, j]</code> กับช่องเพื่อนบ้านที่อยู่ติดกันมี pattern ที่คล้ายคลึงกัน
(ทุกอสมการอยู่ในรูปของ <code>data[...] &gt;= data[i, j]</code>) &nbsp;
เราสามารถใช้จุดสังเกตดังกล่าวมาเขียนโค้ดให้ง่ายขึ้นได้ดังนี้</p><div class="highlight"><div class="highlight-wrapper"><table class="highlight-table"><tbody><tr class="highlight-line-noop"><td><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><br></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="c1"># Version 2</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="k">def</span> <span class="nf">local_maxima</span><span class="p">(</span><span class="n">table</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>    <span class="sd">&quot;&quot;&quot;</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="sd">    Compute a list of table indices where each value is a local maximum</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="sd">    in the given table data when comparing to adjacent table cells</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="sd">    (either horizontally, vertically, or diagonally).</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="sd">    &quot;&quot;&quot;</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>    <span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">shape</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>    <span class="n">local_maxima_indices</span> <span class="o">=</span> <span class="p">[]</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><br></pre></td></tr><tr class="highlight-line-noop"><td><pre>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_rows</span><span class="p">):</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_cols</span><span class="p">):</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>            <span class="n">is_candidate</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># whether (i, j) is still a valid local maximum</span></pre></td></tr><tr class="highlight-line-annotated"><td><pre>            <span class="k">for</span> <span class="n">nbr_i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]:</span></pre></td></tr><tr class="highlight-line-annotated"><td><pre>                <span class="k">for</span> <span class="n">nbr_j</span> <span class="ow">in</span> <span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]:</span></pre></td></tr><tr class="highlight-line-annotated"><td><pre>                    <span class="c1"># Check first if neighbor (nbr_i, nbr_j) really exists</span></pre></td></tr><tr class="highlight-line-annotated"><td><pre>                    <span class="k">if</span> <span class="p">(</span><span class="n">nbr_i</span><span class="p">,</span> <span class="n">nbr_j</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span></pre></td></tr><tr class="highlight-line-annotated"><td><pre>                        <span class="k">continue</span>  <span class="c1"># not really a neighbor</span></pre></td></tr><tr class="highlight-line-annotated"><td><pre>                    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">nbr_i</span> <span class="o">&lt;</span> <span class="n">n_rows</span> <span class="ow">and</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">nbr_j</span> <span class="o">&lt;</span> <span class="n">n_cols</span><span class="p">):</span></pre></td></tr><tr class="highlight-line-annotated"><td><pre>                        <span class="k">continue</span>  <span class="c1"># neighbor out of bounds</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>                    <span class="c1"># Comparison validation as before</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>                    <span class="k">if</span> <span class="n">table</span><span class="p">[</span><span class="n">nbr_i</span><span class="p">,</span> <span class="n">nbr_j</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">table</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]:</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>                        <span class="n">is_candidate</span> <span class="o">=</span> <span class="kc">False</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>            <span class="k">if</span> <span class="n">is_candidate</span><span class="p">:</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>                <span class="n">local_maxima_indices</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">))</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><br></pre></td></tr><tr class="highlight-line-noop"><td><pre>    <span class="k">return</span> <span class="n">local_maxima_indices</span></pre></td></tr></tbody></table></div></div><p>การเรียกใช้งานฟังก์ชัน <code>local_maxima</code> (Version 2) ยังคงให้ผลลัพธ์เหมือนเดิม</p><div class="highlight"><div class="highlight-wrapper"><table class="highlight-table"><tbody><tr class="highlight-line-noop"><td><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">local_maxima</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="go">[(1, 0), (1, 2), (3, 3)]</span></pre></td></tr></tbody></table></div></div><p>กล่าวคือเราใช้ <code>(nbr_i, nbr_j)</code> แทนตำแหน่งของช่องแต่ละช่องในตารางย่อย 3&hairsp;×&hairsp;3
ที่อยู่ในละแวกเพื่อนบ้านของช่องหลัก <code>(i, j)</code> โดยใช้ nested for loop ชั้นที่ 3 และ 4 ในโค้ดข้างต้น</p><p>&hairsp;<strong>ข้อพึงระวัง:</strong>&hairsp; เนื่องจากฟังก์ชัน <code>local_maxima</code> (Version 2) ของเราจะพิจารณาตำแหน่งช่อง <code>(nbr_i, nbr_j)</code>
ทั้งหมด 9 ช่องจากเดิมแค่ 8 ช่อง เราจึงต้องระมัดระวัง&hairsp;&hairsp;<em>ไม่</em>&hairsp;&hairsp;นำเคสที่ <code>(nbr_i, nbr_j) == (i, j)</code> มาพิจารณา</p><h3><a class="headeranchor" id="version-3-prepare-your-iterables"></a>Version 3 – Prepare your iterables<a class="headerlink" href="#version-3-prepare-your-iterables" title="Permalink to this headline"></a></h3><p>แม้ว่าโค้ดใน Version 2 นี้จะปรับปรุงให้กระชับขึ้นมากกว่าโค้ดใน Version 1 แล้ว
แต่ก็ทำให้โค้ดบางส่วนอ่านยากขึ้น เพราะมี for statement ซ้อนกันถึง 4 ชั้นเลยทีเดียว</p><p>เราจะจัดการกับโค้ดเจ้าปัญหาดังกล่าวให้อ่านง่ายขึ้น 
ด้วยการ refactor ลอจิกบางส่วนออกจากฟังก์ชันหลักอย่าง <code>local_maxima</code> ให้กลายเป็นฟังก์ชันแยกต่างหาก &nbsp;
กล่าวคือเราจะมีฟังก์ชันใหม่อันหนึ่งที่เอาไว้ช่วยไล่เรียงช่อง <code>(i, j)</code> ทุกช่องในตาราง
และอีกฟังก์ชันหนึ่งเอาไว้ช่วยไล่เรียงช่องเพื่อนบ้าน <code>(nbr_i, nbr_j)</code> ทุกช่องที่อยู่ติดกับช่อง <code>(i, j)</code> ที่กำหนดให้</p><p>โปรแกรมเวอร์ชันใหม่ของเรามีหน้าตาดังต่อไปนี้</p><div class="highlight"><div class="highlight-wrapper"><table class="highlight-table"><tbody><tr class="highlight-line-noop"><td><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><br></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="c1"># Version 3</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="k">def</span> <span class="nf">local_maxima</span><span class="p">(</span><span class="n">table</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>    <span class="sd">&quot;&quot;&quot;</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="sd">    Compute a list of table indices where each value is a local maximum</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="sd">    in the given table data when comparing to adjacent table cells</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="sd">    (either horizontally, vertically, or diagonally).</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="sd">    &quot;&quot;&quot;</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>    <span class="n">local_maxima_indices</span> <span class="o">=</span> <span class="p">[]</span></pre></td></tr><tr class="highlight-line-annotated"><td><pre>    <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">table_cells</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">shape</span><span class="p">):</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>        <span class="n">is_candidate</span> <span class="o">=</span> <span class="kc">True</span></pre></td></tr><tr class="highlight-line-annotated"><td><pre>        <span class="k">for</span> <span class="n">nbr_pos</span> <span class="ow">in</span> <span class="n">adjacent_cells</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">pos</span><span class="p">):</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>            <span class="k">if</span> <span class="n">table</span><span class="p">[</span><span class="n">nbr_pos</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">table</span><span class="p">[</span><span class="n">pos</span><span class="p">]:</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>                <span class="n">is_candidate</span> <span class="o">=</span> <span class="kc">False</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>        <span class="k">if</span> <span class="n">is_candidate</span><span class="p">:</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>            <span class="n">local_maxima_indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>            </pre></td></tr><tr class="highlight-line-noop"><td><pre>    <span class="k">return</span> <span class="n">local_maxima_indices</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><br></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="k">def</span> <span class="nf">table_cells</span><span class="p">(</span><span class="n">shape</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>    <span class="sd">&quot;&quot;&quot;</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="sd">    A list of indices for all cells in a table with a given shape </span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="sd">    which is a tuple of number of rows and columns, respectively.</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="sd">    &quot;&quot;&quot;</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>    <span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span> <span class="o">=</span> <span class="n">shape</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>    <span class="k">return</span> <span class="p">[(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_rows</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_cols</span><span class="p">)]</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><br></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="k">def</span> <span class="nf">adjacent_cells</span><span class="p">(</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>        <span class="n">shape</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> </pre></td></tr><tr class="highlight-line-noop"><td><pre>        <span class="n">main_pos</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>    <span class="sd">&quot;&quot;&quot;</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="sd">    A list of indices of all adjacent cells to the cell indicated by</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="sd">    the provided main pos, subject to the given shape of the table.</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="sd">    &quot;&quot;&quot;</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>    <span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span> <span class="o">=</span> <span class="n">shape</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>    <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">main_pos</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>    </pre></td></tr><tr class="highlight-line-noop"><td><pre>    <span class="n">adjacent_indices</span> <span class="o">=</span> <span class="p">[]</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>    <span class="k">for</span> <span class="n">nbr_i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]:</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>        <span class="k">for</span> <span class="n">nbr_j</span> <span class="ow">in</span> <span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]:</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>            <span class="k">if</span> <span class="p">(</span><span class="n">nbr_i</span><span class="p">,</span> <span class="n">nbr_j</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>                <span class="k">continue</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>            <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">nbr_i</span> <span class="o">&lt;</span> <span class="n">n_rows</span> <span class="ow">and</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">nbr_j</span> <span class="o">&lt;</span> <span class="n">n_cols</span><span class="p">:</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>                <span class="n">adjacent_indices</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">nbr_i</span><span class="p">,</span> <span class="n">nbr_j</span><span class="p">))</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>                </pre></td></tr><tr class="highlight-line-noop"><td><pre>    <span class="k">return</span> <span class="n">adjacent_indices</span></pre></td></tr></tbody></table></div></div><p>เมื่อเทียบโค้ดของฟังก์ชัน <code>local_maxima</code> เวอร์ชันใหม่กับเวอร์ชันที่แล้ว (Version 2) มีสิ่งที่เปลี่ยนแปลงไปดังนี้</p><ol><li>ช่อง <code>(i, j)</code> แต่ละช่องของตารางจะถูกสร้างโดยฟังก์ชัน <code>table_cells</code>
        แทนที่จะเขียน for statement ซ้อนกัน 2 ชั้นขึ้นมาโดยตรง</li><li>ช่องเพื่อนบ้าน <code>(nbr_i, nbr_j)</code> แต่ละช่องที่อยู่ติดกับช่อง <code>(i, j)</code> _ซึ่งไม่ตกขอบตาราง_
        จะถูกสร้างโดยฟังก์ชัน <code>adjacent_cells</code> แทนที่จะใช้ for statement ซ้อนกันอีก 2 ชั้นผสมกับ if statement เพิ่มเติม</li></ol><p>สังเกตว่าโค้ดของฟังก์ชัน <code>local_maxima</code> (Version 3) นี้กระชับและอ่านง่ายขึ้นกว่าเดิม 
เราสามารถมองเห็น intention ของฟังก์ชันได้จากโค้ดโดยตรง โดยเราไม่จำเป็นต้องมานั่งตีความอีกต่อไปว่า 
for statement ที่ซ้อนกันแต่ละชั้น มีจุดประสงค์เอาไว้ทำงานอะไรบ้าง</p><p>นอกจากนั้น ฟังก์ชัน <code>table_cells</code> และ <code>adjacent_cells</code> ที่แยกออกมานั้น
สามารถนำไปใช้ประโยชน์ซ้ำในโอกาสอื่น&hairsp;ๆ ได้
(เช่น นำไปใช้เขียนฟังก์ชัน <code>local_minima</code> เป็นต้น)</p><p>เมื่อเราลองใช้งาน <code>local_maxima</code> (Version 3) ก็พบว่าโปรแกรมยังให้ผลลัพธ์เหมือนเดิม</p><div class="highlight"><div class="highlight-wrapper"><table class="highlight-table"><tbody><tr class="highlight-line-noop"><td><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">local_maxima</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="go">[(1, 0), (1, 2), (3, 3)]</span></pre></td></tr></tbody></table></div></div><p>เอาหละ! มาพักหายใจกันแป๊บหนึ่ง เดี๋ยวมาดูกันว่าเราจะทำให้โค้ด Version 3 ข้างต้นให้ดียิ่งขึ้นได้อย่างไรบ้าง</p>
    <div style="margin: 1.5em"></div>
    <center>[insert elevator song here]</center>
    <div style="margin: 2.5em"></div>
<h3><a class="headeranchor" id="version-4-hairsppart-a-improving-main-function"></a>Version 4 &hairsp;Part A. Improving main function<a class="headerlink" href="#version-4-hairsppart-a-improving-main-function" title="Permalink to this headline"></a></h3><p>เราจะใช้เครื่องมือบางอย่างที่ Python จัดเตรียมไว้เพื่อทำให้ฟังก์ชัน <code>local_maxima</code> สั้นลงกว่าเดิม &nbsp;
มาพิจารณาโค้ดเวอร์ชันใหม่นี้กันเลย</p><div class="highlight"><div class="highlight-wrapper"><table class="highlight-table"><tbody><tr class="highlight-line-noop"><td><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><br></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="c1"># Version 4a</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="k">def</span> <span class="nf">local_maxima</span><span class="p">(</span><span class="n">table</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>    <span class="sd">&quot;&quot;&quot;</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="sd">    Compute a list of table indices where each value is a local maximum</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="sd">    in the given table data when comparing to adjacent table cells</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="sd">    (either horizontally, vertically, or diagonally).</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="sd">    &quot;&quot;&quot;</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>    <span class="n">local_maxima_indices</span> <span class="o">=</span> <span class="p">[]</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>    <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">table_cells</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">shape</span><span class="p">):</span></pre></td></tr><tr class="highlight-line-annotated"><td><pre>        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">table</span><span class="p">[</span><span class="n">nbr_pos</span><span class="p">]</span></pre></td></tr><tr class="highlight-line-annotated"><td><pre>               <span class="k">for</span> <span class="n">nbr_pos</span> <span class="ow">in</span> <span class="n">adjacent_cells</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">pos</span><span class="p">)):</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>            <span class="n">local_maxima_indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>            </pre></td></tr><tr class="highlight-line-noop"><td><pre>    <span class="k">return</span> <span class="n">local_maxima_indices</span></pre></td></tr></tbody></table></div></div><p>เมื่อพิจารณาฟังก์ชัน <code>local_maxima</code> เวอร์ชันล่าสุดนี้เทียบกับ Version 3
จะพบว่าเราได้ย้าย for statement ชั้นในสำหรับตัวแปร <code>nbr_pos</code> เข้าไปอยู่ภายใน generator expression ต่อไปนี้</p><div class="highlight"><div class="highlight-wrapper"><table class="highlight-table"><tbody><tr class="highlight-line-noop"><td><pre><span></span><span class="c1"># This portion of the code is a generator expression</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="p">(</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>    <span class="n">table</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">table</span><span class="p">[</span><span class="n">nbr_pos</span><span class="p">]</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>    <span class="k">for</span> <span class="n">nbr_pos</span> <span class="ow">in</span> <span class="n">adjacent_cells</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="p">)</span></pre></td></tr></tbody></table></div></div><p>จากนั้น generator expression ดังกล่าวก็ถูกป้อนเป็น input argument ของฟังก์ชัน <code>all</code>
(ซึ่งเป็นฟังก์ชันที่สามารถเรียกใช้งานได้โดยไม่จำเป็นต้อง <code>import</code> ก่อน)</p><p>&hairsp;<strong>หมายเหตุ:</strong>&hairsp; หากพิจารณา <a href="https://docs.python.org/3/library/functions.html#all">documentation</a> 
ของฟังก์ชัน <code>all</code>
จะพบว่า input argument สามารถเป็นวัตถุ iterable ใดก็ได้ รวมถึง generator expression ที่เราเขียนไว้ข้างต้นด้วย</p><p>สิ่งที่น่าสนใจเกี่ยวกับโค้ด Version 4&hairsp;a นี้ก็คือ เมื่ออ่านตาม syntax ของโค้ดข้างต้นจะได้ความว่า</p><blockquote>“ให้พิจารณาช่อง <code>pos</code> แต่ละตำแหน่งในตาราง
    แล้วหาว่ามีช่องใดบ้างที่มีค่ามากกว่าช่องเพื่อนบ้าน <code>nbr_pos</code> ทุกช่อง”</blockquote><p>ซึ่งมีความหมายสอดคล้องและคล้ายคลึงกับนิยามของโจทย์ที่กำหนดไว้ในช่วงต้นของบทความนี้อย่างมาก</p><h3><a class="headeranchor" id="version-4-hairsppart-b-using-generator-expression-with-table_cells"></a>Version 4 &hairsp;Part B. Using generator expression with table_cells<a class="headerlink" href="#version-4-hairsppart-b-using-generator-expression-with-table_cells" title="Permalink to this headline"></a></h3><p>ในฟังก์ชัน <code>local_maxima</code> (Version 3) สังเกตว่าเราเรียกใช้ฟังก์ชัน <code>table_cells</code> (Version 3)
ซึ่งให้ผลลัพธ์ออกมาเป็น <code>list</code> ของตำแหน่งทุกช่องในตาราง &nbsp;
แล้วจากนั้นเราจึงไล่ดูช่องตารางทีละช่องโดยจาก list ดังกล่าวโดยใช้ for statement</p><p>แต่<a href="python-iterables-part-1.paxter">จากบทความที่แล้ว</a>เราได้กล่าวไว้ว่า
วัตถุที่ใช้คู่กับ for statement สามารถเป็นวัตถุ iterable ใดก็ได้ ไม่จำเป็นต้องเป็นโครงสร้างข้อมูลอย่างเช่น list เสมอไป &nbsp;
ฉะนั้นแล้วเราจะลองแก้ไขฟังก์ชัน <code>table_cells</code> ให้รีเทิร์นค่าออกมาเป็นวัตถุ iterator 
โดยเปลี่ยนจาก list comprehension ให้กลายเป็น &hairsp;<strong>generator expression</strong>&hairsp; ซึ่งออกมาเป็นโค้ดดังต่อไปนี้</p><div class="highlight"><input type="checkbox" id="140647802456576" class="highlight-checkbox-input"/><label for="140647802456576" class="highlight-checkbox-label">Display Diff</label><div class="highlight-wrapper"><table class="highlight-table"><tbody><tr class="highlight-line-noop"><td><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Iterator</span><span class="p">,</span> <span class="n">Tuple</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><br></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="c1"># Version 4 Part B</span></pre></td></tr><tr class="highlight-line-delete"><td><pre><span class="k">def</span> <span class="nf">table_cells</span><span class="p">(</span><span class="n">shape</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span></pre></td></tr><tr class="highlight-line-insert"><td><pre><span class="k">def</span> <span class="nf">table_cells</span><span class="p">(</span><span class="n">shape</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>    <span class="sd">&quot;&quot;&quot;</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="sd">    An iterator of indices for all cells in a table with a given shape</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="sd">    which is a tuple of number of rows and columns, respectively.</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="sd">    &quot;&quot;&quot;</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>    <span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span> <span class="o">=</span> <span class="n">shape</span></pre></td></tr><tr class="highlight-line-delete"><td><pre>    <span class="k">return</span> <span class="p">[(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_rows</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_cols</span><span class="p">)]</span></pre></td></tr><tr class="highlight-line-insert"><td><pre>    <span class="k">return</span> <span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_rows</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_cols</span><span class="p">))</span></pre></td></tr></tbody></table></div></div><p>แล้วการเขียนฟังก์ชันที่รีเทิร์นค่าเป็นวัตถุ iterator มันดีกว่าการสร้าง list โดยตรงอย่างไรบ้างในสถานการณ์เช่นนี้?</p><div id="anchor-iterator-to-list"></div><ol><li><p>ฟังก์ชันที่สร้างวัตถุ iterator นั้น&hairsp;<strong>ให้อิสระแก่ผู้เรียกใช้งานฟังก์ชัน</strong>&hairsp;มากกว่าการสร้าง list
        นั่นเพราะว่าเราสามารถแปลงวัตถุ iterator ดังกล่าวให้กลายเป็น list ได้ด้วยการแคสด้วย
        <code>list</code> constructor ได้เสมอ
        (<code>list</code> จะแปลงข้อมูล iterable ใด&hairsp;ๆ ที่รับมาให้กลายเป็น list ตามที่ระบุไว้ใน
        <a href="https://docs.python.org/3/library/functions.html#func-list">documentation</a>)</p><p>ยกตัวอย่างเช่น</p><div class="highlight"><div class="highlight-wrapper"><table class="highlight-table"><tbody><tr class="highlight-line-noop"><td><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">table_cells</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="go">&lt;generator object table_cells.&lt;locals&gt;.&lt;genexpr&gt; at 0x7fc0dec0ffee&gt;</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">table_cells</span><span class="p">(</span><span class="n">shape</span><span class="p">))</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="go">[(0, 0), (0, 1), (0, 2), (1, 0), (1, 1), (1, 2)]</span></pre></td></tr></tbody></table></div></div></li><li><p>เมื่อพิจารณาในกรณีที่โปรแกรมเราใช้งาน for statement กับวัตถุ iterable
        เพื่อ&hairsp;<strong>ประมวลผลสมาชิกเพียงครั้งละ 1 ตัวเท่านั้น</strong>&hairsp;
        (ดังเช่นที่เกิดขึ้นภายในฟังก์ชัน <code>local_maxima</code> Version 3
        ซึ่งเราจะพิจารณาช่องตารางเพียงทีละ 1 ช่องเท่านั้น)</p><p>หมายความว่าเราไม่จำเป็นต้องคำนวณตำแหน่งของช่องตารางทุกช่องไว้ล่วงหน้าทั้งหมด
        ซึ่งยังมีผลให้เปลืองพื้นที่หน่วยความจำเพื่อเก็บลำดับของช่องตารางทั้งหมดดังกล่าวอีกด้วย
        (ลองคิดดูว่าหากข้อมูลตารางมีขนาดใหญ่เช่น <span class="math-inline">10,\!000 \times 10,\!000</span>
        เราจะเสียพื้นที่ไปกี่ MB โดยไม่มีเหตุจำเป็น)</p><p>ฉะนั้นแล้วเราเลือกที่จะ&hairsp;&hairsp;<em>ไม่สร้างลำดับ</em>&hairsp;&hairsp;ของช่องตารางทั้งหมดไว้ล่วงหน้า
        แต่จะค่อย&hairsp;ๆ สร้างลำดับดังกล่าวอย่าง&hairsp;<strong>ขี้เกียจ</strong>&hairsp;ที่สุด
        (เรียกว่าเป็น &hairsp;<strong>lazily constructed sequence</strong>&hairsp;) &nbsp;
        กล่าวคือเราจะคำนวณสมาชิกตัวถัดไปของลำดับนี้ก็ต่อเมื่อถึงเวลาที่
        for statement ขอเรียกดูสมาชิกตัวดังกล่าวไปประมวลผลเท่านั้น
        ซึ่งการเขียน generator expression ก็เป็นหนึ่งวิธีที่จะสร้าง lazily constructed sequence อย่างที่ปรารถนาได้</p></li></ol><p>&hairsp;<strong>บทแทรก:</strong>&hairsp; ข้อตกลง (convention) ของภาษา Python กำหนดไว้ว่า
วัตถุประเภท iterator ถือว่าเป็น iterable ชนิดหนึ่งที่สามารถไล่เรียกดูสมาชิกทุกตัวได้เพียง&hairsp;<strong>รอบเดียว</strong>&hairsp;เท่านั้น &nbsp;
(เพราะในทางเทคนิคแล้ว method ชื่อ <code>__iter__(self)</code> มักจะรีเทิร์น <code>self</code> ออกมาโดยตรง
ทำให้ไม่เกิด iterator อันใหม่สำหรับวัตถุที่เป็น iterator อยู่แล้วแต่แรก) &nbsp;
ผู้ใช้งานจึงควรระมัดระวังการใช้งานวัตถุ iterator ซ้ำกันเกิน 1 รอบ ยกตัวอย่างเช่น</p><div class="highlight"><div class="highlight-wrapper"><table class="highlight-table"><tbody><tr class="highlight-line-noop"><td><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">iterator</span> <span class="o">=</span> <span class="n">table_cells</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">iterator</span><span class="p">)</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="go">[(0, 0), (0, 1), (0, 2), (1, 0), (1, 1), (1, 2)]</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">iterator</span><span class="p">)</span>  <span class="c1"># iterator has previously been fully consumed</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="go">[]</span></pre></td></tr></tbody></table></div></div><p>&hairsp;<strong>หมายเหตุ:</strong>&hairsp; อันที่จริงแล้ว เราอาจเรียกใช้ฟังก์ชัน
<code>numpy.ndindex(*shape)</code><label for="sidenote-7feb1e4df220" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sidenote-7feb1e4df220" class="margin-toggle"/><span class="sidenote"><a href="https://www.numpy.org/devdocs/reference/generated/numpy.ndindex.html">See reference</a></span>
แทนการสร้างและเรียกใช้งานฟังก์ชัน <code>table_cells(shape)</code> ก็ได้</p><h3><a class="headeranchor" id="version-4-hairsppart-c-using-generator-function-for-adjacent_cells"></a>Version 4 &hairsp;Part C. Using generator function for adjacent_cells<a class="headerlink" href="#version-4-hairsppart-c-using-generator-function-for-adjacent_cells" title="Permalink to this headline"></a></h3><p>เมื่อสักครู่เราแก้ไขฟังก์ชัน <code>table_cells</code> จากเดิมที่รีเทิร์นค่าเป็น list ให้กลายเป็นวัตถุ iterator ใน Version 4&hairsp;b กันไปแล้ว &nbsp;
เราจะนำไอเดียเดียวกันนี้มาประยุกต์ใช้กับฟังก์ชัน <code>adjacent_cells</code> ดูบ้าง &nbsp;
แต่ถ้าจะเปลี่ยนโค้ดของ <code>adjacent_cells</code> ให้หันมาใช้ generator expression ก็คงยุ่งยากวุ่นวายเกินไป &nbsp;
ดังนั้นเราจะใช้ความสามารถอีกอย่างหนึ่งของภาษา Python นั่นก็คือ &hairsp;<strong>generator function</strong>&hairsp;</p><p>เราจะข้ามไปดูโค้ดเวอร์ชันใหม่ของ <code>adjacent_cells</code> กันเลย</p><div class="highlight"><input type="checkbox" id="140647802467712" class="highlight-checkbox-input"/><label for="140647802467712" class="highlight-checkbox-label">Display Diff</label><div class="highlight-wrapper"><table class="highlight-table"><tbody><tr class="highlight-line-noop"><td><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Iterator</span><span class="p">,</span> <span class="n">Tuple</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><br></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="c1"># Version 4 Part C</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="k">def</span> <span class="nf">adjacent_cells</span><span class="p">(</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>        <span class="n">shape</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> </pre></td></tr><tr class="highlight-line-noop"><td><pre>        <span class="n">main_pos</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span></pre></td></tr><tr class="highlight-line-delete"><td><pre><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span></pre></td></tr><tr class="highlight-line-insert"><td><pre><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>    <span class="sd">&quot;&quot;&quot;</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="sd">    An iterator of indices of all adjacent cells to the cell indicated by</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="sd">    the provided main pos, subject to the given shape of the table.</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="sd">    &quot;&quot;&quot;</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>    <span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span> <span class="o">=</span> <span class="n">shape</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>    <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">main_pos</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>    </pre></td></tr><tr class="highlight-line-delete"><td><pre>    <span class="n">adjacent_indices</span> <span class="o">=</span> <span class="p">[]</span>     </pre></td></tr><tr class="highlight-line-noop"><td><pre>    <span class="k">for</span> <span class="n">nbr_i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]:</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>        <span class="k">for</span> <span class="n">nbr_j</span> <span class="ow">in</span> <span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]:</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>            <span class="k">if</span> <span class="p">(</span><span class="n">nbr_i</span><span class="p">,</span> <span class="n">nbr_j</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>                <span class="k">continue</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>            <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">nbr_i</span> <span class="o">&lt;</span> <span class="n">n_rows</span> <span class="ow">and</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">nbr_j</span> <span class="o">&lt;</span> <span class="n">n_cols</span><span class="p">:</span></pre></td></tr><tr class="highlight-line-delete"><td><pre>                <span class="n">adjacent_indices</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">nbr_i</span><span class="p">,</span> <span class="n">nbr_j</span><span class="p">))</span></pre></td></tr><tr class="highlight-line-insert"><td><pre>                <span class="k">yield</span> <span class="n">nbr_i</span><span class="p">,</span> <span class="n">nbr_j</span></pre></td></tr></tbody></table></div></div><p>สิ่งที่เปลี่ยนไปจากโค้ดเดิมคือ
1. เราลบโค้ดส่วนที่เกี่ยวข้องกับลิสต์ <code>adjacent_indices</code> ออก และ 
2. แทนที่เราจะ append ค่าของ <code>(nbr_i, nbr_j)</code> ยัดลงใน list เราเลือกใช้ <code>yield</code> statement เพื่อคืนค่าตำแหน่งเหล่านั้นทีละตัวแทน</p><p>“แล้วคำสั่ง <code>yield</code> มันทำอะไร?”&nbsp; อธิบายโดยคร่าวคือ</p><ul><li>เมื่อ&hairsp;&hairsp;<em>ฟังก์ชัน</em>&hairsp;&hairsp;ใดก็ตามมี keyword คำว่า <code>yield</code> ปรากฏอยู่
        จะทำให้ฟังก์ชันดังกล่าวนั้นกลายร่างเป็น “generator function” ในทันที</li><li><p>การเรียกใช้งาน generator function จะให้ผลลัพธ์เป็น “generator object” ซึ่งจัดเป็นวัตถุ iterator ชนิดหนึ่ง
        แต่ว่า body ของฟังก์ชันดังกล่าวจะ&hairsp;&hairsp;<em>ยังไม่เริ่มทำงาน</em>&hairsp;&hairsp;ในทันที</p><p>&hairsp;<strong>หมายเหตุ:</strong>&hairsp; อันที่จริงแล้วเมื่อเรารัน generator expression
        (ดังเช่นในฟังก์ชัน <code>table_cell</code> Version 4–B)
        ก็จะได้ผลลัพธ์เป็น generator object เช่นเดียวกัน</p></li><li>เมื่อมีการ&hairsp;&hairsp;<em>เริ่ม</em>&hairsp;&hairsp;ไล่เรียกดูสมาชิกแต่ละตัวของวัตถุ generator/iterator &nbsp;
        (ไม่ว่าจะเกิดจากการใช้งานวัตถุดังกล่าวกับ for statement หรือด้วยกระบวนการอื่นใดก็ตาม) &nbsp;
        แล้ว generator function ดังกล่าวจึงจะ&hairsp;&hairsp;<em>เริ่ม</em>&hairsp;&hairsp;ทำงาน</li><li>และทุก&hairsp;ๆ ครั้งที่ generator function ทำงานถึงบรรทัดคำสั่ง <code>yield</code>
        ค่าของ<abbr title="expression">นิพจน์</abbr>ใน yield statement
        จะถูกรีเทิร์นออกไปเป็นหนึ่งค่าของวัตถุ generator/iterator &nbsp;
        ส่วน generator function นี้จะ&hairsp;<strong>หยุดการทำงานชั่วคราว</strong>&hairsp;
        จนกว่าจะมี&hairsp;<strong>การเรียกขอดูค่าถัดไป</strong>&hairsp;ของวัตถุ generator/iterator นี้</li><li>วัตถุ generator/iterator จะสิ้นสุดลงก็ต่อเมื่อเกิดจากรีเทิร์นออกจากฟังก์ชัน
        (ไม่ว่าจะด้วย return statement หรือว่าฟังก์ชันถูกรันจนจบถึงบรรทัดสุดท้ายก็ตาม)</li></ul><p>ดังนั้นแล้ว ฟังก์ชัน <code>adjacent_cells</code> (Version 4&hairsp;c) นี้ก็จะสร้างวัตถุ iterator
ซึ่งจะไล่เรียงช่องเพื่อนบ้านทุกอย่างที่อยู่ติดกับช่อง <code>main_pos</code> ที่รับเข้ามาเป็นข้อมูลนำเข้า
ออกมาทีละช่องผ่านคำสั่ง <code>yield</code> &nbsp;
นับว่าเป็น lazily constructed sequence เช่นเดียวกับฟังก์ชัน <code>table_cells</code> (Version 4&hairsp;b)</p><h3><a class="headeranchor" id="summary-of-version-4"></a>Summary of Version 4<a class="headerlink" href="#summary-of-version-4" title="Permalink to this headline"></a></h3><p>เรานำโค้ด Version 4 ของทั้งสามฟังก์ชันมาประกอบรวมกัน กลายเป็นโปรแกรมดังต่อไปนี้</p><div class="highlight"><div class="highlight-wrapper"><table class="highlight-table"><tbody><tr class="highlight-line-noop"><td><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Iterator</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><br></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="c1"># Version 4</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="k">def</span> <span class="nf">local_maxima</span><span class="p">(</span><span class="n">table</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>    <span class="sd">&quot;&quot;&quot;</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="sd">    Compute a list of table indices where each value is a local maximum</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="sd">    in the given table data when comparing to adjacent table cells</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="sd">    (either horizontally, vertically, or diagonally).</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="sd">    &quot;&quot;&quot;</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>    <span class="n">local_maxima_indices</span> <span class="o">=</span> <span class="p">[]</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>    <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">table_cells</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">shape</span><span class="p">):</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">table</span><span class="p">[</span><span class="n">nbr_pos</span><span class="p">]</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>               <span class="k">for</span> <span class="n">nbr_pos</span> <span class="ow">in</span> <span class="n">adjacent_cells</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">pos</span><span class="p">)):</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>            <span class="n">local_maxima_indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>            </pre></td></tr><tr class="highlight-line-noop"><td><pre>    <span class="k">return</span> <span class="n">local_maxima_indices</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>    </pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="k">def</span> <span class="nf">table_cells</span><span class="p">(</span><span class="n">shape</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>    <span class="sd">&quot;&quot;&quot;</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="sd">    An iterator of indices for all cells in a table with a given shape</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="sd">    which is a tuple of number of rows and columns, respectively.</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="sd">    &quot;&quot;&quot;</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>    <span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span> <span class="o">=</span> <span class="n">shape</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>    <span class="k">return</span> <span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_rows</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_cols</span><span class="p">))</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>    </pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="k">def</span> <span class="nf">adjacent_cells</span><span class="p">(</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>        <span class="n">shape</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> </pre></td></tr><tr class="highlight-line-noop"><td><pre>        <span class="n">main_pos</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>    <span class="sd">&quot;&quot;&quot;</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="sd">    An iterator of indices of all adjacent cells to the cell indicated by</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="sd">    the provided main pos, subject to the given shape of the table.</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="sd">    &quot;&quot;&quot;</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>    <span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span> <span class="o">=</span> <span class="n">shape</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>    <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">main_pos</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>    </pre></td></tr><tr class="highlight-line-noop"><td><pre>    <span class="k">for</span> <span class="n">nbr_i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]:</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>        <span class="k">for</span> <span class="n">nbr_j</span> <span class="ow">in</span> <span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]:</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>            <span class="k">if</span> <span class="p">(</span><span class="n">nbr_i</span><span class="p">,</span> <span class="n">nbr_j</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>                <span class="k">continue</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>            <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">nbr_i</span> <span class="o">&lt;</span> <span class="n">n_rows</span> <span class="ow">and</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">nbr_j</span> <span class="o">&lt;</span> <span class="n">n_cols</span><span class="p">:</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>                <span class="k">yield</span> <span class="n">nbr_i</span><span class="p">,</span> <span class="n">nbr_j</span></pre></td></tr></tbody></table></div></div>
    <div style="margin: 2.5em"></div>
    <center>[insert bogo advert here]</center>
    <div style="margin: 3.5em"></div>
<p>ช่วงโปรโมชันพิเศษ เราขอแถมโจทย์ปัญหาอีก 1 ข้อ</p><h2><a class="headeranchor" id="payhaa-kh-taaraangsngmitimii-local-maximum-yaangnyhnuengchnghruueaim"></a>ปัญหา ข. ตารางสองมิติมี local maximum อย่างน้อยหนึ่งช่องหรือไม่<a class="headerlink" href="#payhaa-kh-taaraangsngmitimii-local-maximum-yaangnyhnuengchnghruueaim" title="Permalink to this headline"></a></h2><blockquote><p>สมมติว่ามีข้อมูลเป็นตารางสองมิติ โดยที่แต่ละช่องมีค่าเป็นจำนวนจริง</p><p>จงหาว่าในข้อมูลตารางนี้ มีช่องอย่างน้อน 1 ช่องที่มีค่าเป็น local maximum หรือไม่
    โดยให้ตอบเป็นค่าบูลีน <code>True</code> หรือ <code>False</code></p><p>&hairsp;<strong>หมายเหตุ:</strong>&hairsp; โปรดสังเกตว่า มีกรณีที่คำตอบของคำถามข้างนี้สามารถเป็น <code>False</code>
    เช่น ในกรณีที่ตารางมีขนาดใหญ่กว่า 1&hairsp;×&hairsp;1 และทุกช่องในตารางมีค่าเท่ากัน</p></blockquote><p>สังเกตว่าปัญหา ข. นี้ถามหา “existence of a solution”
ซึ่งเป็นเพียง &hairsp;<em>corollary</em>&hairsp; ของปัญหา ก. ดั้งเดิมที่ให้ “enumerate all solutions” เท่านั้นเอง</p><p>สมมติว่ามีข้อมูลตารางอยู่ในตัวแปรชื่อ <code>table</code> แล้วต้องการค้นหาว่า <code>table</code> 
มี local maximum อย่างน้อยหนึ่งช่องหรือไม่ &nbsp;
เราสามารถแก้ปัญหาง่าย&hairsp;ๆ ได้ดังนี้</p><p>1. สั่งรัน <code>local_maxima(table)</code> เพื่อคำนวณหาลิสต์ของ local maxima ทั้งหมดของข้อมูลในตัวแปร <code>table</code>
2. ตรวจสอบว่าผลลัพธ์จากข้อที่แล้ว เป็นสิลต์ที่มีความยาวอย่างน้อย 1 หรือไม่</p><div class="highlight"><div class="highlight-wrapper"><table class="highlight-table"><tbody><tr class="highlight-line-noop"><td><pre><span></span><span class="c1"># Note: In Python, a list evaluates to True under an if statement</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="c1"># if and only if the list is non-empty.</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="k">if</span> <span class="n">local_maxima</span><span class="p">(</span><span class="n">table</span><span class="p">):</span>  <span class="c1"># from version 4</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The table contains at least 1 local maximum.&quot;</span><span class="p">)</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="k">else</span><span class="p">:</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The table has no local maxima.&quot;</span><span class="p">)</span></pre></td></tr></tbody></table></div></div><p>แต่ประสิทธิภาพของวิธีการแก้ปัญหาข้างต้นนี้ยังไม่เป็นที่น่าพอใจ &nbsp;
กล่าวคือโจทย์ข้อนี้เราต้องการทราบแค่ว่า &nbsp;“มี&hairsp;<strong>คำตอบอย่างน้อย 1 ช่อง</strong>&hairsp;หรือไม่”&nbsp; เพียงแค่นั้น
แต่ฟังก์ชัน <code>local_maxima</code> ที่เราเรียกใช้งานกลับรีเทิร์นค่าเป็น &nbsp;“ลิสต์ของ&hairsp;<strong>คำตอบทั้งหมด</strong>&hairsp;”&nbsp;
ซึ่งเป็นข้อมูลที่ &hairsp;<em>มากเกินความจำเป็น</em>&hairsp; ในการตอบคำถาม</p><p>จะดีหรือไม่ หากเราสามารถควบคุมการทำงานฟังก์ชัน <code>local_maxima</code> สร้างลำดับของช่องตารางที่เป็น local maximum 
ที่มีลักษณะเป็น lazily constructed sequence เช่นเดียวกับฟังก์ชัน <code>table_cells</code> และ <code>adjacent_cells</code> &nbsp;
(หมายความว่า ช่องตารางที่มีค่าเป็น local maximum แต่ละช่องจะถูกคำนวณก็ต่อเมื่อถึงเวลาที่ช่องดังกล่าวถูกเรียกดูเท่านั้น)</p><h3><a class="headeranchor" id="version-5-changing-return-type-of-main-function"></a>Version 5 – Changing return type of main function<a class="headerlink" href="#version-5-changing-return-type-of-main-function" title="Permalink to this headline"></a></h3><p>ก่อนที่จะพูดถึงจุดประสงค์ในการดัดแปลงฟังก์ชัน <code>local_maxima</code> ให้รีเทิร์นค่าวัตถุ iterator แทนที่จะเป็น <code>list</code> แบบเก่า
เราจะไปดูโค้ดที่มีการแก้ไขกันก่อน</p><div class="highlight"><input type="checkbox" id="140647802476336" class="highlight-checkbox-input"/><label for="140647802476336" class="highlight-checkbox-label">Display Diff</label><div class="highlight-wrapper"><table class="highlight-table"><tbody><tr class="highlight-line-noop"><td><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Iterator</span><span class="p">,</span> <span class="n">Tuple</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><br></pre></td></tr><tr class="highlight-line-noop"><td><pre><br></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="c1"># Version 5 (new function signature)</span></pre></td></tr><tr class="highlight-line-delete"><td><pre><span class="k">def</span> <span class="nf">local_maxima</span><span class="p">(</span><span class="n">table</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span></pre></td></tr><tr class="highlight-line-insert"><td><pre><span class="k">def</span> <span class="nf">local_maxima</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>    <span class="sd">&quot;&quot;&quot;</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="sd">    An iterator of table indices where each value is a local maximum</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="sd">    in the given table data when comparing to adjacent table cells</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="sd">    (either horizontally, vertically, or diagonally).</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="sd">    &quot;&quot;&quot;</span></pre></td></tr><tr class="highlight-line-delete"><td><pre>    <span class="n">local_maxima_indices</span> <span class="o">=</span> <span class="p">[]</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>    <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">table_cells</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">):</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">data</span><span class="p">[</span><span class="n">nbr_pos</span><span class="p">]</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>               <span class="k">for</span> <span class="n">nbr_pos</span> <span class="ow">in</span> <span class="n">adjacent_cells</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">pos</span><span class="p">)):</span></pre></td></tr><tr class="highlight-line-delete"><td><pre>            <span class="n">local_maxima_indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span></pre></td></tr><tr class="highlight-line-insert"><td><pre>            <span class="k">yield</span> <span class="n">pos</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><br></pre></td></tr><tr class="highlight-line-delete"><td><pre>    <span class="k">return</span> <span class="n">local_maxima_indices</span>    </pre></td></tr><tr class="highlight-line-noop"><td><pre>            </pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="c1"># table_cells and adjacent_cells remain unchanged</span></pre></td></tr></tbody></table></div></div><p>เราดัดแปลงให้ฟังก์ชัน <code>local_maxima</code> กลายเป็น generator function ใน Version 5 นี้
(ด้วยกระบวนการที่คล้ายกับการดัดแปลงฟังก์ชัน <code>adjacent_cells</code> ใน Version 4&hairsp;c)</p><p>&hairsp;<strong>หมายเหตุ:</strong>&hairsp; อย่าลืมว่าถ้าเราต้องการผลลัพธ์เป็นลิสต์แบบเก่า เราก็เพียงแค่นำวัตถุ iterator ไปใส่ใน
list constructor ได้<a href="#anchor-iterator-to-list">ดังที่เคยกล่าวไปแล้ว</a></p><p>แล้วการทำให้ฟังก์ชัน <code>local_maxima</code> รีเทิร์นเป็นวัตถุ iterator จะช่วยให้ตอบปัญหา ข. อย่างมีประสิทธิภาพได้อย่างไร? &nbsp;
ลองพิจารณาจิ๊กซอว์สองชิ้นนี้</p><ul><li>เราต้องการทราบเพียงแค่ว่าตารางข้อมูลสองมิติที่กำหนดให้ มี local maximum อย่างน้อย 1 ช่องหรือไม่ &nbsp;
        นั่นแปลว่าหากเราพบ local maximum ช่องแรกของตารางแล้ว
        ค่า local maximum ที่เหลือในตารางก็ไม่มีนัยยะสำคัญอีกต่อไปนี้</li><li>ฟังก์ชัน <code>local_maxima</code> (Version 5) เป็น generator function ที่จะค้นหาตำแหน่งของ local maximum
        ในข้อมูลตารางที่รับเป็นข้อมูลนำเข้า เพียงทีละ 1 ช่องเท่านั้น &nbsp;
        และจะมีหยุดการทำงานชั่วคราวจนกว่าจะมีการขอให้ดำเนินการค้นหา local maximum ตัวถัดไป</li></ul><p>ดังนั้นแล้ว เราขอตั้งปัญหาในรูปทั่วไปดังต่อไปนี้</p><hr /><h3><a class="headeranchor" id="payhaayy-trwcchsbwaawatthu-iterable-aimwaangeplaa"></a>ปัญหาย่อย: ตรวจสอบว่าวัตถุ iterable ไม่ว่างเปล่า<a class="headerlink" href="#payhaayy-trwcchsbwaawatthu-iterable-aimwaangeplaa" title="Permalink to this headline"></a></h3><blockquote>เราจะสามารถตรวจสอบว่าวัตถุ iterable ใด&hairsp;ๆ มีสมาชิกอย่างน้อย 1 ตัวหรือไม่ ได้อย่างไร
    โดยไม่จำเป็นต้องพยายามไล่ดูสมาชิกของวัตถุ iterable เกิน 1 ตัว</blockquote><p>เราสามารถเขียน &hairsp;<em>รูปแบบนิพจน์</em>&hairsp; <code>any(True for _ in iterable)</code>
เพื่อทดสอบว่าวัตถุ <code>iterable</code> ในนิพจน์ดังกล่าวมีสมาชิกอย่างน้อย 1 ตัวหรือไม่ได้ &nbsp;
รูปแบบนิพจน์ดังกล่าวอาศัยความสามารถ short-circuiting ของฟังก์ชัน <code>any</code> เพื่อยุติการทำงานเมื่อทราบผลลัพธ์เป็นที่แน่นอนแล้ว
(โปรดดู <a href="https://docs.python.org/3/library/functions.html#any">documentation</a> ประกอบ) &nbsp;
ยกตัวอย่างเช่น</p><div class="highlight"><div class="highlight-wrapper"><table class="highlight-table"><tbody><tr class="highlight-line-noop"><td><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">odd_digits</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">any</span><span class="p">(</span><span class="kc">True</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">odd_digits</span><span class="p">)</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="go">True</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">even_digits</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">any</span><span class="p">(</span><span class="kc">True</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">even_digits</span><span class="p">)</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="go">True</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">empty_sequence</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">)</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">any</span><span class="p">(</span><span class="kc">True</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">empty_sequence</span><span class="p">)</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="go">False</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">sequence_of_false</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">i</span><span class="p">)</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">any</span><span class="p">(</span><span class="kc">True</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">sequence_of_false</span><span class="p">)</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="go">True</span></pre></td></tr></tbody></table></div></div><p>มีคำถาม 2 คำถามที่อาจเป็นที่สนใจ แต่จะขออนุญาตทิ้งไว้ให้เป็นคำถามชวนคิดด้วยตนเอง</p><ol><li>ทำไมเราจึงไม่ใช้รูปแบบนิพจน์ <code>any(iterable)</code> ไปเลย
        แต่กลับใช้รูปแบบนิพจน์ <code>any(True for _ in iterable)</code> แทน?</li><li>เราจะออกแบบการทดลองอย่างไร จึงจะทำให้มั่นใจได้ว่ารูปแบบนิพจน์ <code>any(True for _ in iterable)</code>
        จะยุติการทำงานทันทีหลังจากที่วัตถุ iterable ปล่อยค่าสมาชิกตัวแรกออกมาแล้ว?</li></ol><hr /><p>มาพิจารณาปัญหา ข. กันอีกครั้งหนึ่ง นั่นคือเราอยากทราบว่าข้อมูลตารางที่กำหนดให้มี local maximum อย่างน้อย 1 ช่องหรือไม่? &nbsp;
แต่ในคราวนี้ เรามีเครื่องมือพร้อมที่จะแก้ปัญหานี้อย่างมีประสิทธิภาพมากขึ้นกัน</p><p>โค้ดที่จะใช้ตรวจสอบว่า “ผลลัพธ์ของ <code>local_maxima</code> (Version 5) จะเป็นวัตถุ iterator ที่ไม่ว่างเปล่าหรือไม่”
อย่างมีประสิทธิภาพ สามารถเขียนได้ดังนี้</p><div class="highlight"><div class="highlight-wrapper"><table class="highlight-table"><tbody><tr class="highlight-line-noop"><td><pre><span></span><span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="kc">True</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">local_maxima</span><span class="p">(</span><span class="n">table</span><span class="p">)):</span>  <span class="c1"># from version 5</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The table contains at least 1 local maximum.&quot;</span><span class="p">)</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="k">else</span><span class="p">:</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The table has no local maxima.&quot;</span><span class="p">)</span></pre></td></tr></tbody></table></div></div><h2><a class="headeranchor" id="bthsrupsngthaay"></a>บทสรุปส่งท้าย<a class="headerlink" href="#bthsrupsngthaay" title="Permalink to this headline"></a></h2><p>บทความนี้ได้นำเสนอวิธีการต่าง&hairsp;ๆ ที่จะช่วยทำให้การทำงานกับ for statement และวัตถุ iterable
จนกลายออกมาเป็นโค้ดที่อ่านง่าย ดูสละสลวย และมีประสิทธิภาพที่ดี</p><p>เมื่อใดก็ตามที่เราจะต้องทำงานกับ for statement หรือวัตถุ iterable เราอาจจะถามคำถามต่อไปนี้กับตนเอง</p><ol><li>มีโค้ดส่วนใดที่เกี่ยวข้องกับ iteration
        ที่สามารถแยกออกเป็นฟังก์ชันต่างหากที่รีเทิร์นค่าออกมาเป็นวัตถุ iterator หรือไม่?</li><li>มีโค้ดส่วนใดที่เดิมรีเทิร์นค่าเป็น list
        แล้วจะมีโอกาสให้โค้ดมีประสิทธิภาพดีขึ้นหากเราเปลี่ยนให้รีเทิร์นเป็นวัตถุ iterator หรือไม่?</li><li>มีฟังก์ชันใน Python standard library ใดที่จะช่วยให้การทำงานกับวัตถุ iterable ง่ายขึ้นหรือไม่? &nbsp;
        (&hairsp;<strong>คำแนะนำ:</strong>&hairsp; สามารถค้นหาฟังก์ชันเหล่านี้เพิ่มเติมได้จากแพ็กเกจ
        <a href="https://docs.python.org/3/library/itertools.html">itertools</a> และ
        <a href="https://more-itertools.readthedocs.io/en/stable/api.html">more-itertools</a>
        เป็นต้น)</li></ol><p>และขอปิดท้ายด้วยโค้ดเวอร์ชันสุดท้ายของฟังก์ชันนี่เราได้พยายามปรับปรุงให้ดียิ่งขึ้น</p><div class="highlight"><div class="highlight-wrapper"><table class="highlight-table"><tbody><tr class="highlight-line-noop"><td><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Iterator</span><span class="p">,</span> <span class="n">Tuple</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><br></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="k">def</span> <span class="nf">local_maxima</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>    <span class="sd">&quot;&quot;&quot;</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="sd">    An iterator of table indices where each value is a local maximum</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="sd">    in the given table data when comparing to adjacent table cells</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="sd">    (either horizontally, vertically, or diagonally).</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="sd">    &quot;&quot;&quot;</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>    <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">table_cells</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">):</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">data</span><span class="p">[</span><span class="n">nbr_pos</span><span class="p">]</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>               <span class="k">for</span> <span class="n">nbr_pos</span> <span class="ow">in</span> <span class="n">adjacent_cells</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">pos</span><span class="p">)):</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>            <span class="k">yield</span> <span class="n">pos</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>    </pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="k">def</span> <span class="nf">table_cells</span><span class="p">(</span><span class="n">shape</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>    <span class="sd">&quot;&quot;&quot;</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="sd">    An iterator of indices for all cells in a table with a given shape</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="sd">    which is a tuple of number of rows and columns, respectively.</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="sd">    &quot;&quot;&quot;</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>    <span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span> <span class="o">=</span> <span class="n">shape</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>    <span class="k">return</span> <span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_rows</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_cols</span><span class="p">))</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>    </pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="k">def</span> <span class="nf">adjacent_cells</span><span class="p">(</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>        <span class="n">shape</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> </pre></td></tr><tr class="highlight-line-noop"><td><pre>        <span class="n">main_pos</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>    <span class="sd">&quot;&quot;&quot;</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="sd">    An iterator of indices of all adjacent cells to the cell indicated by</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="sd">    the provided main pos, subject to the given shape of the table.</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="sd">    &quot;&quot;&quot;</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>    <span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span> <span class="o">=</span> <span class="n">shape</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>    <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">main_pos</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>    </pre></td></tr><tr class="highlight-line-noop"><td><pre>    <span class="k">for</span> <span class="n">nbr_i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]:</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>        <span class="k">for</span> <span class="n">nbr_j</span> <span class="ow">in</span> <span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]:</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>            <span class="k">if</span> <span class="p">(</span><span class="n">nbr_i</span><span class="p">,</span> <span class="n">nbr_j</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>                <span class="k">continue</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>            <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">nbr_i</span> <span class="o">&lt;</span> <span class="n">n_rows</span> <span class="ow">and</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">nbr_j</span> <span class="o">&lt;</span> <span class="n">n_cols</span><span class="p">:</span></pre></td></tr><tr class="highlight-line-noop"><td><pre>                <span class="k">yield</span> <span class="n">nbr_i</span><span class="p">,</span> <span class="n">nbr_j</span></pre></td></tr></tbody></table></div></div><div class="highlight"><div class="highlight-wrapper"><table class="highlight-table"><tbody><tr class="highlight-line-noop"><td><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span>  <span class="mi">0</span><span class="p">],</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="gp">... </span>                 <span class="p">[</span> <span class="mi">8</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span>  <span class="mi">9</span><span class="p">,</span>  <span class="mi">1</span><span class="p">],</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="gp">... </span>                 <span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span>  <span class="mi">2</span><span class="p">],</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="gp">... </span>                 <span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span>  <span class="mi">6</span><span class="p">]])</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">local_maxima</span><span class="p">(</span><span class="n">grid</span><span class="p">))</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="go">[(1, 0), (1, 2), (3, 3)]</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">any</span><span class="p">(</span><span class="kc">True</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">local_maxima</span><span class="p">(</span><span class="n">grid</span><span class="p">))</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="go">True</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">plains</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="gp">... </span>                   <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">]])</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">any</span><span class="p">(</span><span class="kc">True</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">local_maxima</span><span class="p">(</span><span class="n">plains</span><span class="p">))</span></pre></td></tr><tr class="highlight-line-noop"><td><pre><span class="go">False</span></pre></td></tr></tbody></table></div></div><p>ป.ล. บทความนี้อาจจะยาวกว่าปกติ ต้องขออภัยมา ณ ที่นี้ &nbsp;
ขอขอบคุณเพื่อน&hairsp;ๆ ที่เสียสละเวลาอ่าน draft ของบทความและให้ feedback เพื่อใช้ปรับปรุงบทความนี้ให้ดียิ่งขึ้น &nbsp;
และขอขอบคุณผู้อ่านทุกอ่านที่อ่านบทความจนจบครับ</p><p>ในบทความถัด&hairsp;ๆ ไปจะขอเว้นจากการเขียนเกี่ยวกับ Python Iterables สักพักหนี่ง
แต่อาจจะพูดถึงหัวข้อที่ advance มากขึ้น หรืออาจจะพูดถึงเรื่องบันเทิงอื่น&hairsp;ๆ บ้างตามประสา โปรดติดตามชม</p>
                </div>
            </section>

        </article>
    </div>
</main>

<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed">
                <article class="read-next-card">
                    <header class="read-next-card-header">
                        <h3><span>More in</span> <a href="/category/coding">coding</a></h3>
                    </header>
                    <div class="read-next-card-content">
                        <ul>
                            <li>
                                <h4><a href="/posts/python-iterables-part-3-advanced-generator-functions">Advanced Generator Functions – Python Iterables Part 3 of N</a></h4>
                                <div class="read-next-card-meta">
                                    <p><time datetime="2020-04-15T00:00:00+07:00">Wed 15 April 2020</time> –
                                        8 min</p>
                                </div>
                            </li>
                            <li>
                                <h4><a href="/posts/on-fuzziness-of-terminology-compiling-vs-interpreting">On Fuzziness of Terminology: Compiling vs Interpreting</a></h4>
                                <div class="read-next-card-meta">
                                    <p><time datetime="2020-03-31T00:00:00+07:00">Tue 31 March 2020</time> –
                                        15 min</p>
                                </div>
                            </li>
                            <li>
                                <h4><a href="/posts/python-iterables-part-1">For Statements – Python Iterables Part 1 of N</a></h4>
                                <div class="read-next-card-meta">
                                    <p><time datetime="2019-06-05T00:00:00+07:00">Wed 05 June 2019</time> –
                                        8 min</p>
                                </div>
                            </li>
                        </ul>
                    </div>
                    <footer class="read-next-card-footer">
                        <a href="/category/coding">
                            See all 4 posts
                        </a>
                    </footer>
                </article>

                <article class="post-card post ">

    <a class="post-card-image-link" href="/posts/on-fuzziness-of-terminology-compiling-vs-interpreting">
        <img class="post-card-image"
             sizes="(max-width: 1000px) 400px, 700px"
             src="/images/featured/bird-butt-at-sb-wharf.jpg"
             alt="On Fuzziness of Terminology: Compiling vs Interpreting"
        />
    </a>

    <div class="post-card-content">
        <a class="post-card-content-link" href="/posts/on-fuzziness-of-terminology-compiling-vs-interpreting">
            <header class="post-card-header">
                <div class="post-card-primary-tag">coding</div>
                <h2 class="post-card-title">On Fuzziness of Terminology: Compiling vs Interpreting</h2>
            </header>
            <section class="post-card-excerpt">
                <p>เมื่อเราต้องทำงานกับภาษาโปรแกรม (programming language) ภาษาต่าง&hairsp;ๆ มากกว่า 1 ภาษา เรามักจะพบว่าแต่ละภาษามีลักษณะที่แตกต่างกันออกไปเสมือนว่าแต่ละภาษาก็มีโลกเป็นของตัวเอง หนึ่งในความแตกต่างทั้งหลายที่เห็นได้ชัดเจนที่สุดก็คือ &hairsp;ลักษณะของภาษาที่จะทำงานแบบ compile หรือว่าแบบ interpret&hairsp;ก …</p>
            </section>
        </a>

        <footer class="post-card-meta">
            <ul class="author-list">
                <li class="author-list-item">
                    <div class="author-name-tooltip">Abhabongse Janthong</div>
                    <a href="/author/abhabongse-janthong" class="static-avatar">
                        <img class="author-profile-image"
                             src="/avatars/d59f180139c7ef4544b6f34b97ed942cf4f486a3e833683a9ca1e1b298e18ca8.jpg"
                             alt="Abhabongse Janthong"
                        />
                    </a>
                </li>
            </ul>
            <div class="post-card-byline-content">
                <span>
                    Abhabongse Janthong
                </span>
                <span class="post-card-byline-date">
                    <time datetime="2020-03-31T00:00:00+07:00">Tue 31 March 2020</time>
                    <span class="bull">&bull;</span>
                    15 min read
                </span>
            </div>
        </footer>
    </div>
</article>

                <article class="post-card post ">

    <a class="post-card-image-link" href="/posts/python-iterables-part-1">
        <img class="post-card-image"
             sizes="(max-width: 1000px) 400px, 700px"
             src="/images/featured/gajoen-blue-stone.jpg"
             alt="For Statements – Python Iterables Part 1 of N"
        />
    </a>

    <div class="post-card-content">
        <a class="post-card-content-link" href="/posts/python-iterables-part-1">
            <header class="post-card-header">
                <div class="post-card-primary-tag">coding</div>
                <h2 class="post-card-title">For Statements – Python Iterables Part 1 of N</h2>
            </header>
            <section class="post-card-excerpt">
                <p>ตอนแรกอยากเปิด blog ด้วยหัวข้อบันเทิงหน่อย ๆ แต่เผอิญได้ไอเดียเขียนเรื่องจริงจังระหว่างที่ทำงานอยู่ เลยได้เรื่องเขียนเกี่ยวกับของที่เจอบ่อยอย่าง for loop ในภาษา Python เสียหน่อยแล้วกันเคยสังเกตไหมว่า for statement ในภาษา Python จะใช้งานกับ …</p>
            </section>
        </a>

        <footer class="post-card-meta">
            <ul class="author-list">
                <li class="author-list-item">
                    <div class="author-name-tooltip">Abhabongse Janthong</div>
                    <a href="/author/abhabongse-janthong" class="static-avatar">
                        <img class="author-profile-image"
                             src="/avatars/d59f180139c7ef4544b6f34b97ed942cf4f486a3e833683a9ca1e1b298e18ca8.jpg"
                             alt="Abhabongse Janthong"
                        />
                    </a>
                </li>
            </ul>
            <div class="post-card-byline-content">
                <span>
                    Abhabongse Janthong
                </span>
                <span class="post-card-byline-date">
                    <time datetime="2019-06-05T00:00:00+07:00">Wed 05 June 2019</time>
                    <span class="bull">&bull;</span>
                    8 min read
                </span>
            </div>
        </footer>
    </div>
</article>
        </div>
    </div>
</aside>


    <footer class="site-footer outer">
        <div class="site-footer-content inner">
            <section class="copyright">
                <a href="/">Personal Blog</a>
                &copy;
2020&hairsp;&ndash;&hairsp;2021
            </section>
            <nav class="site-footer-nav">
                <a href="/">Latest Posts</a>
                <a href="https://facebook.com/abhabongse" target="_blank" rel="noopener">Facebook</a>
                <a href="https://twitter.com/abhabongse" target="_blank" rel="noopener">Twitter</a>
                <a href="https://github.com/abhabongse" target="_blank" rel="noopener">GitHub</a>
            </nav>
        </div>
    </footer>
</div>

<script src="/theme/js/main.min.js"></script>
<script>
    ready(function () {
        // Replace nav with title on scroll - start
        Casper.stickyNavTitle({
            navSelector: '.site-nav-main',
            titleSelector: '.post-full-title',
            activeClass: 'nav-post-title-active'
        });
        // Replace nav with title on scroll - end

        // Hover on avatar
        var hoverTimeout;
        document.querySelectorAll('.author-list-item').forEach(function(listItem) {
            listItem.addEventListener('mouseover', function(_) {
                clearTimeout(hoverTimeout);
                document.querySelectorAll('.author-card').forEach(function(cardItem) {
                    cardItem.classList.remove('hovered');
                });
                listItem.querySelectorAll('.author-card').forEach(function(cardItem) {
                    cardItem.classList.add('hovered');
                });
            });
            listItem.addEventListener('mouseleave', function(_) {
                hoverTimeout = setTimeout(function() {
                    listItem.querySelectorAll('.author-card').forEach(function(cardItem) {
                        cardItem.classList.remove('hovered');
                    });
                }, 800);
            });
        });
    });
</script>
</body>
</html>